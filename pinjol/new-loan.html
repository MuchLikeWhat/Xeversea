<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0", user-scalable=no>
    <link rel="icon" href="assets/images/icons/favicon.ico" type="image/x-icon">
    <title>Xeversea | New Loan </title>
    <link rel="stylesheet" href="/css/all.css">
    <link rel="stylesheet" href="/css/pj.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script type="text/javascript">
      (function(){
        emailjs.init({
          publicKey: "qlvZy1IXp8XRdMp9-",
        });
      })();
    </script>
</head>
<body>
 <header>
    <nav aria-label="Main navigation">
      <div class="container">
        <ul>
          <li><a href="/index">Home</a></li>
          <li><a href="/project">Projects</a></li>
          <li><a href="/member">Members</a></li>
          <li><a href="/term">Terms</a></li>
          <li><a href="/credit">Credits</a></li>
          <li><a href="/redeem">Redeem</a></li>
        </ul>
      </div>
    </nav>
    <nav class="pinjol">
    <div class="pinnav">
        <ul>
            <li><a href="dashboard.html">Dashboard</a></li>
            <li><a href="new-loan.html">New Loan</a></li>
        </ul>
    </div>
    </nav>
  </header>
<main>
  <div class="loan-panel" role="region" aria-labelledby="loan-title">
    <div class="loan-header">
      <h1 id="loan-title">Loan Request</h1>
      <div class="loan-meta">Fast review · Secure · Non-binding request</div>
    </div>

    <form id="request" novalidate>
      <!-- Honeypot field for bots (should remain empty) -->
      <div class="hp-hide" aria-hidden="true">
        <label for="hp">Leave empty</label>
        <input type="text" id="hp" name="hp" autocomplete="off" tabindex="-1">
      </div>

      <label for="email" class="full">Email <span style="color:#d32f2f">*</span></label>
      <input type="email" id="email" name="email" required placeholder="your.email@example.com" class="full">

      <div class="verify-section full">
        <div class="verify-row">
          <input type="text" id="verify-code" name="verify-code" placeholder="Enter 6-digit code" maxlength="6" inputmode="numeric" disabled>
          <button type="button" id="verifyBtn" onclick="sendVerificationCode()">Send code</button>
        </div>
        <div class="verify-status" id="verify-status"></div>
      </div>

      <div>
        <label for="phone">Phone number (optional)</label>
        <input type="tel" id="phone" name="phone" placeholder="+62812345678" inputmode="tel">
      </div>

      <div></div>

      <label for="amount" class="full">Enter loan amount (IDR)</label>
      <input list="amount-suggestions" type="number" id="amount" name="amount" min="1000" max="100000" step="500" required inputmode="numeric" placeholder="e.g. 10000" class="full">
      <datalist id="amount-suggestions">
        <option value="1000"><option value="5000"><option value="10000"><option value="25000"><option value="50000"><option value="100000">
      </datalist>

      <div>
        <label for="term">Loan term</label>
        <select id="term" name="term" required>
          <option value="">Select term</option>
          <option value="3">3 days</option>
          <option value="7">7 days</option>
          <option value="14">14 days</option>
        </select>
      </div>

      <label for="reason" class="full">Reason for Loan</label>
      <textarea id="reason" name="reason" required maxlength="200" placeholder="Short reason (max 200 chars)" class="full"></textarea>

      <div class="fees full">
        <p>Fee: <strong><span id="fee">-</span></strong> IDR</p>
        <p>Total to repay: <strong><span id="total">-</span></strong> IDR</p>
      </div>

      <div class="legal full">
        <strong>Loan rules & agreement</strong>
        <ul>
          <li>Borrowing limit: IDR 1,000 — IDR 100,000.</li>
          <li>Fee = 3% of loan, rounded to the nearest 500 IDR. Late fee = 500 IDR/day.</li>
          <li>Payment method is always cash pickup.</li>
          <li>Submitting a request is not a binding contract. Final approval, amounts and due date are set by review.</li>
          <li>By submitting you consent to processing this request and the data in accordance with our <a href="/term">terms</a> and <a href="/privacy">privacy policy</a>.</li>
        </ul>
      </div>

      <div class="full agree">
        <input type="checkbox" id="agree" name="agree" required>
        <label for="agree" class="small-note">I have read and agree to the loan rules and privacy policy.</label>
      </div>

      <div class="full actions">
        <button type="submit" id="submitBtn">Submit request</button>
        <div class="small-note">We will review and contact you. This demo mode does not create a binding loan.</div>
      </div>

      <p id="formMsg" class="full" role="status" aria-live="polite"></p>
    </form>
  </div>
</main>

<script>
  // Send verification code to email (demo: stores in localStorage)
  async function sendVerificationCode() {
    const email = document.getElementById('email').value.trim();
    const verifyBtn = document.getElementById('verifyBtn');
    const verifyStatus = document.getElementById('verify-status');
    const verifyCodeEl = document.getElementById('verify-code');

    if (!email) {
      verifyStatus.textContent = 'Enter email first';
      verifyStatus.className = 'verify-status error';
      return;
    }

    verifyBtn.disabled = true;
    verifyBtn.textContent = 'Sending...';
    verifyStatus.textContent = 'Sending code...';
    verifyStatus.className = 'verify-status';

    try {
      const code = Math.floor(100000 + Math.random() * 900000).toString();
      emailjs.send("service_zsrixrb", "template_ofli2zb", { email, passcode: code }).then((response) => {
          if (response.status === 200) {
              localStorage.setItem('verify_code', code);
              localStorage.setItem('verify_email', email);
              verifyStatus.textContent = 'Code sent to ' + email;
              verifyStatus.className = 'verify-status success';
              verifyCodeEl.disabled = false;
              verifyCodeEl.focus();
          } else {
              verifyStatus.textContent = 'Error sending code';
              verifyStatus.className = 'verify-status error';
          }
      });
    } catch (err) {
      verifyStatus.textContent = 'Error sending code';
      verifyStatus.className = 'verify-status error';
    } finally {
      verifyBtn.disabled = false;
      verifyBtn.textContent = 'Send code';
    }
  }
</script>
  <footer>
      <div class="container">      
      <h2>Contact & Social</h2>
            <dl>
            <dt>Instagram</dt>
                <dd><a href="https://www.instagram.com/x_eversea?igsh=dHZ2aTZ5d2ZkOWRx">@Xeversea</a></dd>
            <dt>Email</dt>
                <dd><a href="mailto:x.eversea@gmail.com">x.eversea@gmail.com</a></dd>
            <dt>Discord</dt>
              <dd><a href="https://discord.gg/tuSdVGbMJX" target="_blank" rel="noopener">Join our Discord</a></dd>
            </dl>
  <p>© 2025 Xeversea — Grade 10 Showcase. Created by <a href="https://github.com/MuchLikeWhat">Jiho</a>, Maitreyawira Palembang School.</p>
  </div>
  </footer>
<script src="/pinjol/new-loan.js" defer></script>
</body>
</html>
